logging {
	level  = "debug"
	format = "logfmt"
}

tracing {
	// Sample all traces. This value should be lower for production configs!
	sampling_fraction = 1

	write_to = [otelcol.exporter.otlp.tempo.input]
}

otelcol.receiver.jaeger "jaeger" {
    protocols {
    grpc {}
    thrift_http {}
    thrift_binary {}
    thrift_compact {}
  }
    output {
        traces = [otelcol.processor.trail_sampling.tempo.input]
    }
}

otelcol.receiver.otlp "tempo" {
    grpc {
        endpoint = "0.0.0.0:4317"
    }
    output {
        traces = [otelcol.processor.trail_sampling.tempo.input]
    }
}

otelcol.processor.trail_sampling "tempo" {
    policy {
        name = "ignores"
        query = "{ name =~ `.*/config` }"
        probabilistic = 0
    }

    policy {
        name = "default"
        query = "{}"
        probabilistic = 1
    }

    output {
        traces = [otelcol.exporter.otlp.tempo.input]
    }
}

otelcol.exporter.otlp "tempo" {
	client {
		endpoint = "tempo:4317"

		tls {
			insecure = true
		}
	}
}